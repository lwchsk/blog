---
title: MySQL
tags:
  - 参考
---
### 聚簇索引
### 回表
### 索引种类
### SQL执行过程
### 视图
### 分库、分表思路

在实际使用中由于有框架的存在所以九成的SQL语法都用不到，至于一些概念可能会在解决bug的时候提供思路，例如导入sql时提示超时说明没有连接上，这时修改连接等待时间可能有用

### 笔记

### 零散

1. 引擎大略

4

1. InnoDB页单位 磁盘和内存交互 管理存储空间
2. 行格式 COMPACT行格式 Redundant行格式 Dynamic和Compressed行格式 行溢出
    5
3. . InnoDB不同类型页，数据页 。
4. 一个数据页可以被大致划分为7个部分，分别是 File Header ，表示页的一些通用信息，占固定的38字节。 Page Header ，表示数据页专有的一些信息，占固定的56个字节。 Infimum + Supremum ，两个虚拟的伪记录，分别表示页中的最小和最大记录，占固定的 26 个字节。 User Records ：真实存储我们插入的记录的部分，大小不固定。 Free Space ：页中尚未使用的部分，大小不确定。 Page Directory ：页中的某些记录相对位置，也就是各个槽在页面中的地址偏移量，大小不固定，插 入的记录越多，这个部分占用的空间越多。 File Trailer ：用于检验页是否完整的部分，占用固定的8个字节。
5. 头信息 next_record 单链表 。
6. InnoDB 会为把页中的记录划分为若干个组，每个组的最后一个记录的地址偏移量作为一个 槽 ，存放在 Page Directory 中，所以在一个页中根据主键查找记录是非常快的，分为两步： 通过二分法确定该记录所在的槽。 通过记录的next_record属性遍历该槽所在的组中的各个记录。
7. File Header编号 双链表 。
8. 内存磁盘 LSN校验 同步。
9. SQL执行过程业务和引擎 连接分析优化执行器相继执行后由执行器调用引擎的读写接口

### B+树索引
1. 新分配不连续 页分裂确保状态 每页一个目录项 主键是该页记录最小主键方便定位 用户记录和目录项记录record_type区分
2. 聚簇索引 都在叶子节点 查某列有索引即查该列否则回表影响性能 组合索引本质二级最左匹配直到遇到第一个不能匹配的字段 不等于两个索引MyISAM 皆 二级索引 
3. 根节点不动 数据复制
4. 其余有哈希全文空间全文空间前缀和复合索引

### B+树索引的使用

1. 空间时间都有代价
2. 全值匹配 列和索引列一致
3. 全值匹配最左匹配范围匹配排序分组
4. 使用覆盖索引二级索引包含查询所需字段避免回表减少io提高查询速度减少内存占用
5.  为了尽可能少的让 聚簇索引 发生页面分裂和记录移位的情况，建议让主键拥有 AUTO_INCREMENT 属性。

### innodb表空间

1. 区概念 连续 随机io非常慢
1. 段概念等

### 表连接查询

1.  内连接返回两表符合条件交集，左右连接合称外连接左连接将左表匹配右表为空的数据加入结果，右连接相反
2. 不推荐多表join 大量数据消耗cpu和内存 占用数据库资源

### MySQL成本

1. io成本 CPU成本

